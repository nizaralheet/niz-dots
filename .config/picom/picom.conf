#################################
#           Shadows             #
#################################

shadow = false

shadow-radius = 70
shadow-offset-x = 0
shadow-offset-y = 0

shadow-exclude = [
  "name = 'Notification'",
  "class_g = 'Conky'",
  "class_g ?= 'Notify-osd'",
  "class_g = 'Cairo-clock'",
  "class_g = 'qtile'",
  "class_g = 'brave'",
  "class_g *?= 'slop'",
  "QTILE_INTERNAL:32c = 1",
  "_GTK_FRAME_EXTENTS@:c"
];

crop-shadow-to-monitor = true; 


#################################
#           Fading              #
#################################

fading = false;
fade-in-step = 0.035;
fade-out-step = 0.035;
fade-delta = 10


#################################
#   Transparency / Opacity      #
#################################

inactive-opacity-override = false;
active-opacity = 1
inactive-opacity = 0.88

focus-exclude = [
  "class_g= 'kitty'",
  "class_g= 'thunar'",
  "class_g='skippy-xd'",
  "class_g = 'i3lock'",
  "class_g = 'Cairo-clock'" ,
  "QTILE_INTERNAL:32c = 1",
  "class_g= 'Rofi'"
];


#################################
#           Corners             #
#################################

corner-radius = 12;

rounded-corners-exclude = [
  "class_g='Dunst'",
  "class_g='awesome'",
  "class_g='skippy-xd'"
]; 


#################################
#             Blur              #
#################################

blur: {
  method = "dual_kawase";
  strength = 8;
  background = true;
  background-frame = false;
  background-fixed = false;
}

blur-background-exclude = [
  "class_g = 'i3lock'",
  "window_type = 'dock'",
  "window_type = 'desktop'",
  "_GTK_FRAME_EXTENTS@:c",
  "class_g = 'Brave'",
  "class_g = 'Discord'",
  "class_g = 'Dunst'",
  "class_g = 'Peek'",
  "class_g *?= 'slop'",
];


#################################
#       General Settings        #
#################################

backend = "glx"
dithered-present = false;
vsync = true
mark-wmwin-focused = true;
mark-ovredir-focused = false
detect-rounded-corners = false;
detect-client-opacity = false;
use-ewmh-active-win = true;
unredir-if-possible = false;
detect-transient = true;
glx-no-stencil = true;
use-damage = true;
xrender-sync-fence = true;
window-shader-fg = "default";
transparent-clipping = false;
log-level = "warn";


#################################
#         Window Types          #
#################################

wintypes:
{
  tooltip = { fade = true; shadow = true; opacity = 0.75; focus = true; full-shadow = false; };
  dock = { shadow = false; clip-shadow-above = true; }
  dnd = { shadow = false; }
  popup_menu = { opacity = 0.8; }
  dropdown_menu = { opacity = 0.8; }
};


#################################
#        Opacity Rules          #
#################################

opacity-rule = [
  "100:class_g = 'skippy-xd'",
  "100:class_g = 'i3lock'",
  "100:class_g = 'St' && focused",
  "50:class_g = 'St' && !focused",
  "100:fullscreen",
];


#################################
#         Window Rules          #
#################################

# Fast dropdown animation for menus ONLY
rules = (
  {
    match = "window_type = 'popup_menu' || window_type = 'dropdown_menu' || window_type = 'menu'";
    animations = (
      {
        triggers = ["open", "show"];
        opacity = {
          curve = "cubic-bezier(0.3,1.0,0.4,1)";
          duration = 0.15;
          start = 0;
          end = "window-raw-opacity";
        };
        offset-y = {
          curve = "cubic-bezier(0.3,1.0,0.4,1)";
          duration = 0.15;
          start = -10;
          end = 0;
        };
      },
      {
        triggers = ["close", "hide"];
        opacity = {
          duration = 0.1;
          start = "window-raw-opacity-before";
          end = 0;
        };
        offset-y = {
          duration = 0.1;
          start = 0;
          end = -5;
        };
      }
    );
  }
);


#################################
#         Animations            #
#################################

# Global animations for ALL OTHER windows
animations = (
  # Close/Hide animation
  {
    triggers = ["close","hide"];
    preset = "disappear"
    scale = 0.
    opacity = {
      duration = 0.15;
      start = "window-raw-opacity-before";
      end = 0;
    };
    blur-opacity = "opacity";
    shadow-opacity = "opacity";
  },
  # Open/Show animation with BOUNCE effect
  {
    triggers = ["open","show"];
    opacity = {
      curve = "cubic-bezier(0.25,0.46,0.45,0.94)";
      duration = 0.2;
      start = 0;
      end = "window-raw-opacity";
    }
    blur-opacity = "opacity";
    shadow-opacity = "opacity";
    offset-x = "(1 - scale-x) / 2 * window-width";
    offset-y = "(1 - scale-y) / 2 * window-height";
    scale-x = {
      # This curve creates a bounce/overshoot effect
      curve = "cubic-bezier(0.175,0.885,0.32,1.175)";
      duration = 0.27;
      start = 0.7;
      end = 1;
    };
    scale-y = "scale-x";
    shadow-scale-x = "scale-x";
    shadow-scale-y = "scale-y";
    shadow-offset-x = "offset-x";
    shadow-offset-y = "offset-y";
  },
  # Geometry animation - smooth position/size change WITHOUT content stretching
  {
    triggers = ["geometry"]
    # Only animate position, not scale - this prevents content stretching
    offset-x = {
      curve = "cubic-bezier(0.3,1.0,0.4,1)";
      duration = 0.15;
      start = "window-x-before - window-x";
      end = 0;
    }
    offset-y = {
      curve = "cubic-bezier(0.3,1.0,0.4,1)";
      duration = 0.15;
      start = "window-y-before - window-y";
      end = 0;
    }
    # Animate shadow position to match window
    shadow-offset-x = "offset-x";
    shadow-offset-y = "offset-y";
  }
)
